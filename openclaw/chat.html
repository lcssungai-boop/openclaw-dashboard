<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0C0C0C">
<title>OpenClaw · Chat</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0C0C0C;--bg2:#111111;--bg3:#171717;--bg4:#1E1E1E;
  --panel:#111111;--border:#222222;--border2:#2E2E2E;
  --text:#C0C0BE;--dim:#787876;--muted:#404040;--bright:#E8E8E6;
  --green:#3A8A58;--accent:#5A8A6A;--red:#8A4040;
  --safe-top:env(safe-area-inset-top,0px);
  --safe-bottom:env(safe-area-inset-bottom,0px);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{height:100%;height:-webkit-fill-available}
body{
  background:var(--bg);color:var(--text);
  font-family:"Noto Sans TC",sans-serif;font-weight:300;
  display:flex;flex-direction:column;
  height:100vh;height:-webkit-fill-available;
  overflow:hidden;-webkit-font-smoothing:antialiased;
}
::-webkit-scrollbar{width:2px}
::-webkit-scrollbar-thumb{background:var(--border2)}

/* Header */
header{
  flex-shrink:0;display:flex;align-items:center;justify-content:space-between;
  padding:0 16px;
  padding-top:max(var(--safe-top),0px);
  height:calc(48px + max(var(--safe-top),0px));
  background:rgba(12,12,12,.95);border-bottom:1px solid var(--border);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
}
.hdr-l{display:flex;align-items:center;gap:10px}
.back-btn{display:flex;align-items:center;font-size:13px;color:var(--dim);text-decoration:none;padding:8px 4px}
.hdr-div{width:1px;height:16px;background:var(--border);flex-shrink:0}
.hdr-name{font-size:14px;font-weight:500;color:var(--bright)}
.hdr-sub{font-size:10px;color:var(--muted);margin-top:1px;letter-spacing:.08em;text-transform:uppercase}
.hdr-r{display:flex;align-items:center;gap:2px}
.icon-btn{background:none;border:none;color:var(--muted);cursor:pointer;
  padding:10px 8px;display:flex;align-items:center;border-radius:6px;min-width:36px;min-height:36px}
.icon-btn:active{background:var(--bg3)}
.icon-btn.active{color:var(--accent)}

/* Messages */
.msgs{flex:1;overflow-y:auto;overflow-x:hidden;padding:16px 14px;
  display:flex;flex-direction:column;gap:14px;-webkit-overflow-scrolling:touch}

.msg{display:flex;gap:8px;animation:fadeIn .18s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.msg.user{flex-direction:row-reverse}

.msg-avatar{width:26px;height:26px;border-radius:50%;flex-shrink:0;display:flex;
  align-items:center;justify-content:center;font-size:9px;
  font-family:"JetBrains Mono",monospace;border:1px solid var(--border2);
  background:var(--bg3);color:var(--dim);margin-top:2px}
.msg.agent .msg-avatar{border-color:var(--accent);color:var(--accent)}

.msg-body{display:flex;flex-direction:column;gap:4px;max-width:calc(100% - 40px)}
.msg.user .msg-body{align-items:flex-end}

.msg-bubble{padding:10px 13px;border-radius:14px;
  font-size:14px;line-height:1.65;word-break:break-word;white-space:pre-wrap}
.msg.user .msg-bubble{background:var(--bg4);border:1px solid var(--border2);
  color:var(--bright);border-bottom-right-radius:4px}
.msg.agent .msg-bubble{background:var(--panel);border:1px solid var(--border);
  color:var(--text);border-bottom-left-radius:4px}
.msg.error .msg-bubble{border-color:var(--red);color:#A87070}

.msg-time{font-size:10px;color:var(--muted);font-family:"JetBrains Mono",monospace;padding:0 2px}

.cursor{display:inline-block;width:6px;height:13px;background:var(--accent);
  margin-left:2px;vertical-align:text-bottom;animation:blink .8s step-end infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}

.sys-msg{text-align:center;padding:6px 0}
.sys-msg span{font-size:10px;color:var(--muted);font-family:"JetBrains Mono",monospace;
  background:var(--bg2);border:1px solid var(--border);padding:2px 10px;border-radius:2px}

.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:10px;padding:32px 24px;text-align:center}
.empty-icon{font-size:32px;opacity:.2;margin-bottom:4px}
.empty-hint{font-size:12px;font-family:"JetBrains Mono",monospace;
  line-height:2;color:var(--muted)}
.empty-hint em{color:var(--border2);font-style:normal}

/* Input */
.input-wrap{flex-shrink:0;border-top:1px solid var(--border);background:var(--bg2);
  padding:10px 14px;
  padding-bottom:calc(10px + max(var(--safe-bottom),0px))}
.input-row{display:flex;gap:8px;align-items:flex-end}
textarea{flex:1;background:var(--bg3);border:1px solid var(--border2);
  color:var(--bright);font-family:"Noto Sans TC",sans-serif;
  font-size:16px;font-weight:300;padding:9px 13px;
  resize:none;min-height:42px;max-height:110px;
  border-radius:10px;outline:none;line-height:1.55;-webkit-appearance:none}
textarea::placeholder{color:var(--muted)}
.send-btn{background:none;border:1px solid var(--border2);color:var(--dim);
  cursor:pointer;padding:0;width:42px;height:42px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:border-color .15s}
.send-btn:not(:disabled):active{background:rgba(90,138,106,.15);border-color:var(--accent)}
.send-btn:disabled{opacity:.25}
.send-btn.sending{border-color:var(--accent)}

/* Status bar */
.status-bar{flex-shrink:0;height:22px;background:var(--bg);border-top:1px solid var(--border);
  display:flex;align-items:center;padding:0 14px;gap:10px;
  font-family:"JetBrains Mono",monospace;font-size:9px;color:var(--muted);overflow:hidden}
.sb-dot{width:5px;height:5px;border-radius:50%;background:var(--muted);flex-shrink:0}
.sb-dot.connected{background:var(--green);box-shadow:0 0 4px var(--green)}
.sb-dot.connecting{background:#8A7030;animation:pulse .8s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.sb-sep{width:1px;height:10px;background:var(--border);flex-shrink:0}
#sbRight{margin-left:auto;display:flex;align-items:center;gap:8px;overflow:hidden}

/* Settings sheet */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;
  display:none;align-items:flex-end;justify-content:center}
.overlay.show{display:flex}
.sheet{background:var(--bg2);border:1px solid var(--border2);border-radius:16px 16px 0 0;
  width:100%;max-width:520px;
  padding:20px 20px calc(20px + max(var(--safe-bottom),0px));
  display:flex;flex-direction:column;gap:18px;animation:slideUp .22s ease}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.sheet-handle{width:36px;height:3px;background:var(--border2);border-radius:2px;align-self:center;margin-bottom:4px}
.sheet-title{font-size:12px;font-weight:500;color:var(--bright);
  letter-spacing:.1em;text-transform:uppercase;font-family:"JetBrains Mono",monospace}
.field{display:flex;flex-direction:column;gap:6px}
.field label{font-size:10px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;font-family:"JetBrains Mono",monospace}
.field input{background:var(--bg3);border:1px solid var(--border2);color:var(--bright);
  font-family:"JetBrains Mono",monospace;font-size:14px;
  padding:10px 12px;border-radius:8px;outline:none;width:100%;-webkit-appearance:none}
.field input:focus{border-color:var(--accent)}
.field input::placeholder{color:var(--muted)}
.sheet-actions{display:flex;gap:10px}
.btn-cancel{flex:1;background:none;border:1px solid var(--border);color:var(--muted);
  cursor:pointer;padding:11px;border-radius:8px;font-size:13px;font-family:"Noto Sans TC",sans-serif}
.btn-save{flex:2;background:rgba(90,138,106,.12);border:1px solid var(--accent);color:var(--accent);
  cursor:pointer;padding:11px;border-radius:8px;font-size:13px;
  font-family:"Noto Sans TC",sans-serif;font-weight:500}
</style>
</head>
<body>

<header>
  <div class="hdr-l">
    <a class="back-btn" href="./">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </a>
    <div class="hdr-div"></div>
    <div>
      <div class="hdr-name">OpenClaw</div>
      <div class="hdr-sub" id="hdrSub">Chat</div>
    </div>
  </div>
  <div class="hdr-r">
    <button class="icon-btn" id="abortBtn" title="停止" style="display:none">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>
    </button>
    <button class="icon-btn" id="clearBtn" title="清空">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/></svg>
    </button>
    <button class="icon-btn" id="settingsBtn" title="設定">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06-.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
    </button>
  </div>
</header>

<div class="msgs" id="msgs">
  <div class="empty-state" id="emptyState">
    <div class="empty-icon">⌘</div>
    <div class="empty-hint">尚無對話<br>輸入訊息開始<br><br><em>先點右上角 ⚙ 填 Gateway 位址</em></div>
  </div>
</div>

<div class="input-wrap">
  <div class="input-row">
    <textarea id="input" placeholder="輸入訊息…" rows="1"></textarea>
    <button class="send-btn" id="sendBtn" disabled>
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </button>
  </div>
</div>

<div class="status-bar">
  <div class="sb-dot" id="sbDot"></div>
  <span id="sbStatus" style="color:var(--muted)">未連線</span>
  <div id="sbRight">
    <div class="sb-sep"></div>
    <span id="sbSession" style="color:var(--muted)">—</span>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-title">連線設定</div>
    <div class="field">
      <label>Gateway URL</label>
      <input type="url" id="cfgUrl" inputmode="url" autocomplete="off" autocapitalize="none" spellcheck="false"
        placeholder="ws://localhost:18789">
    </div>
    <div class="field">
      <label>Gateway Token（選填）</label>
      <input type="password" id="cfgToken" autocomplete="off" placeholder="留空則不帶 token">
    </div>
    <div class="field">
      <label>Session Key（選填）</label>
      <input type="text" id="cfgSession" autocomplete="off" autocapitalize="none" spellcheck="false" placeholder="main">
    </div>
    <div class="sheet-actions">
      <button class="btn-cancel" id="cancelSettings">取消</button>
      <button class="btn-save" id="saveSettings">儲存並連線</button>
    </div>
  </div>
</div>

<script>
// ── Config ──────────────────────────────────────────────────
const STORE = 'oc_chat_cfg_v2';
let cfg = {url:'', token:'', session:'main'};
try{ Object.assign(cfg, JSON.parse(localStorage.getItem(STORE)||'{}')); }catch(e){}
if(!cfg.session) cfg.session = 'main';

// ── State ────────────────────────────────────────────────────
let ws = null, reconnTimer = null, reconnDelay = 800;
let isConn = false, chatRunId = null;
let streamEl = null, streamText = '';
const pending = new Map(); // id → {resolve, reject}

// ── DOM ──────────────────────────────────────────────────────
const $=id=>document.getElementById(id);
const msgsEl=$('msgs'), inputEl=$('input'), sendBtn=$('sendBtn');
const sbDot=$('sbDot'), sbStatus=$('sbStatus'), sbSession=$('sbSession');
const abortBtn=$('abortBtn');

// ── Settings ─────────────────────────────────────────────────
$('settingsBtn').onclick = openSettings;
$('cancelSettings').onclick = closeSettings;
$('saveSettings').onclick = saveAndConnect;
$('clearBtn').onclick = clearChat;
$('overlay').onclick = e => { if(e.target===$('overlay')) closeSettings(); };
abortBtn.onclick = doAbort;

function openSettings(){
  $('cfgUrl').value = cfg.url||'';
  $('cfgToken').value = cfg.token||'';
  $('cfgSession').value = cfg.session||'main';
  $('overlay').classList.add('show');
  $('settingsBtn').classList.add('active');
}
function closeSettings(){
  $('overlay').classList.remove('show');
  $('settingsBtn').classList.remove('active');
}
function saveAndConnect(){
  cfg.url   = $('cfgUrl').value.trim();
  cfg.token = $('cfgToken').value.trim();
  cfg.session = $('cfgSession').value.trim() || 'main';
  localStorage.setItem(STORE, JSON.stringify(cfg));
  closeSettings();
  if(ws){ ws.close(); ws=null; }
  connect();
}

// ── WebSocket / OpenClaw Protocol ────────────────────────────
function genId(){ return Math.random().toString(36).slice(2,10)+Date.now().toString(36); }

function connect(){
  if(!cfg.url){ setStatus('off'); return; }
  setStatus('connecting');
  clearTimeout(reconnTimer);
  try{ ws = new WebSocket(cfg.url); }
  catch(e){ sched(); return; }

  ws.onopen = () => {
    // Wait up to 750ms for connect.challenge; if none, send connect anyway
    setTimeout(() => sendConnect(), 750);
  };
  ws.onclose = () => {
    isConn = false; connectSent = false; setStatus('off');
    sendBtn.disabled = true;
    finalStream();
    for(const[,p] of pending) p.reject(new Error('disconnected'));
    pending.clear();
    addSys('連線中斷，重連中…');
    sched();
  };
  ws.onerror = () => ws.close();
  ws.onmessage = e => {
    let m; try{ m=JSON.parse(e.data); }catch(err){ return; }
    handleMsg(m);
  };
}

function sched(){
  clearTimeout(reconnTimer);
  reconnTimer = setTimeout(connect, reconnDelay);
  reconnDelay = Math.min(reconnDelay * 1.7, 15000);
}

let connectSent = false;
function sendConnect(){
  if(connectSent || !ws || ws.readyState !== WebSocket.OPEN) return;
  connectSent = true;
  request('connect', {
    minProtocol: 3,
    maxProtocol: 3,
    client: {
      id: 'webchat-ui',
      version: 'dev',
      platform: navigator.platform || 'web',
      mode: 'webchat',
      instanceId: genId()
    },
    role: 'operator',
    scopes: ['operator.admin','operator.approvals','operator.pairing'],
    caps: [],
    auth: cfg.token ? {token: cfg.token} : undefined,
    userAgent: navigator.userAgent,
    locale: navigator.language
  }).then(res => {
    isConn = true;
    reconnDelay = 800;
    setStatus('connected');
    sendBtn.disabled = false;
    sbSession.textContent = cfg.session;
    addSys('已連線');
  }).catch(err => {
    addSys('連線失敗：' + (err.message||'?'));
  });
}

function request(method, params){
  return new Promise((resolve, reject) => {
    if(!ws || ws.readyState !== WebSocket.OPEN){ reject(new Error('not connected')); return; }
    const id = genId();
    pending.set(id, {resolve, reject});
    ws.send(JSON.stringify({type:'req', id, method, params}));
    // timeout after 30s
    setTimeout(() => {
      if(pending.has(id)){ pending.delete(id); reject(new Error('timeout')); }
    }, 30000);
  });
}

function handleMsg(m){
  if(m.type === 'event'){
    if(m.event === 'connect.challenge'){
      connectSent = false; // allow sendConnect to proceed
      sendConnect();
      return;
    }
    if(m.event === 'chat'){
      handleChatEvent(m.payload);
      return;
    }
    return;
  }
  if(m.type === 'res'){
    const p = pending.get(m.id);
    if(!p) return;
    pending.delete(m.id);
    m.ok ? p.resolve(m.payload) : p.reject(new Error(m.error?.message || 'request failed'));
  }
}

function handleChatEvent(payload){
  if(!payload || payload.sessionKey !== cfg.session) return;
  const state = payload.state;

  if(state === 'delta'){
    // delta contains FULL current text (replace, not append)
    const text = extractText(payload.message);
    if(typeof text === 'string'){
      if(!streamEl) startStream();
      streamText = text;
      streamEl.querySelector('.stream-text').textContent = streamText;
      scrollBot();
    }
    if(payload.runId) chatRunId = payload.runId;
    setGenerating(true);
    return;
  }

  if(state === 'final'){
    const text = extractText(payload.message);
    finalStream(text);
    setGenerating(false);
    return;
  }

  if(state === 'aborted'){
    const text = extractText(payload.message) || streamText;
    finalStream(text || null);
    setGenerating(false);
    addSys('已中止');
    return;
  }

  if(state === 'error'){
    finalStream(null);
    setGenerating(false);
    addMsg('error', payload.errorMessage || '發生錯誤');
    return;
  }
}

function extractText(msg){
  if(!msg) return null;
  if(typeof msg === 'string') return msg;
  if(Array.isArray(msg.content)){
    return msg.content.filter(c=>c.type==='text').map(c=>c.text).join('');
  }
  if(typeof msg.content === 'string') return msg.content;
  return null;
}

// ── Rendering ────────────────────────────────────────────────
function nowStr(){ return new Date().toLocaleTimeString('zh-TW',{hour:'2-digit',minute:'2-digit',hour12:false}); }
function hideEmpty(){ const e=$('emptyState'); if(e) e.remove(); }
function scrollBot(){ msgsEl.scrollTop = msgsEl.scrollHeight; }

function addMsg(role, text){
  hideEmpty();
  const d = document.createElement('div');
  d.className = 'msg ' + (role==='user'?'user':role==='error'?'agent error':'agent');
  d.innerHTML = `<div class="msg-avatar">${role==='user'?'you':'oc'}</div>
<div class="msg-body">
  <div class="msg-bubble"></div>
  <div class="msg-time">${nowStr()}</div>
</div>`;
  d.querySelector('.msg-bubble').textContent = text;
  msgsEl.appendChild(d); scrollBot(); return d;
}

function startStream(){
  hideEmpty();
  const d = document.createElement('div');
  d.className = 'msg agent';
  d.innerHTML = `<div class="msg-avatar">oc</div>
<div class="msg-body">
  <div class="msg-bubble"><span class="stream-text"></span><span class="cursor"></span></div>
  <div class="msg-time">${nowStr()}</div>
</div>`;
  msgsEl.appendChild(d); streamEl = d; streamText = ''; scrollBot();
}

function finalStream(text){
  if(streamEl){
    const c = streamEl.querySelector('.cursor'); if(c) c.remove();
    if(text !== null && text !== undefined){
      streamEl.querySelector('.stream-text').textContent = text || streamText;
    } else if(!streamText && text === null){
      // no content, remove the bubble
      streamEl.remove();
    }
    streamEl = null; streamText = '';
  } else if(text){
    addMsg('agent', text);
  }
  chatRunId = null;
}

function addSys(text){
  const d = document.createElement('div'); d.className='sys-msg';
  d.innerHTML = `<span>${esc(text)}</span>`;
  msgsEl.appendChild(d); scrollBot();
}

function clearChat(){
  msgsEl.innerHTML = '';
  const e = document.createElement('div'); e.className='empty-state'; e.id='emptyState';
  e.innerHTML = '<div class="empty-icon">⌘</div><div class="empty-hint">對話已清空</div>';
  msgsEl.appendChild(e); streamEl = null; streamText = ''; chatRunId = null;
}

function setStatus(s){
  sbDot.className = 'sb-dot'+(s==='connected'?' connected':s==='connecting'?' connecting':'');
  sbStatus.textContent = s==='connected'?'已連線':s==='connecting'?'連線中…':'未連線';
  sbStatus.style.color = s==='connected'?'var(--green)':s==='connecting'?'#8A7030':'var(--muted)';
}

function setGenerating(on){
  abortBtn.style.display = on ? '' : 'none';
  sendBtn.style.display  = on ? 'none' : '';
  $('hdrSub').textContent = on ? '生成中…' : 'Chat';
}

function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// ── Send / Abort ──────────────────────────────────────────────
function doSend(){
  const text = inputEl.value.trim();
  if(!text || !isConn) return;
  addMsg('user', text);
  inputEl.value = ''; inputEl.style.height = 'auto';

  const idemKey = genId();
  request('chat.send', {
    sessionKey: cfg.session,
    message: {role:'user', content:[{type:'text',text}], timestamp: Date.now()},
    deliver: false,
    idempotencyKey: idemKey,
    attachments: []
  }).then(res => {
    if(res?.runId) chatRunId = res.runId;
  }).catch(err => {
    setGenerating(false);
    addMsg('error', '送出失敗：'+(err.message||'?'));
  });

  startStream();
  setGenerating(true);
}

function doAbort(){
  if(!isConn) return;
  const params = chatRunId
    ? {sessionKey: cfg.session, runId: chatRunId}
    : {sessionKey: cfg.session};
  request('chat.abort', params).catch(()=>{});
}

// ── Input events ──────────────────────────────────────────────
inputEl.addEventListener('input', function(){
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 110) + 'px';
});
inputEl.addEventListener('keydown', function(e){
  if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); doSend(); }
});
sendBtn.onclick = doSend;

// ── Init ──────────────────────────────────────────────────────
if(cfg.url){ connect(); }
else{ setStatus('off'); setTimeout(openSettings, 400); }
</script>
</body>
</html>
