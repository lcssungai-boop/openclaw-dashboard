<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenClaw Â· é–‹ç™¼å„ªåŒ–å¸«</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#F1F1EF;--bg2:#F8F8F7;--bg3:#E8E8E6;
  --panel:#FFFFFF;--border:#E2E2DE;--border2:#C8C8C4;
  --text:#242422;--dim:#8C8C88;--muted:#B4B4B0;
  --bright:#0C0C0A;--accent:#383836;
  --urgent-bg:#FBF5EE;--urgent-bd:#DDB87A;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:"Noto Sans TC",sans-serif;font-weight:300;min-height:100vh;-webkit-font-smoothing:antialiased}

header{
  display:flex;align-items:center;justify-content:space-between;
  padding:0 28px;height:56px;
  background:var(--panel);border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:200;
}
.hdr-l{display:flex;align-items:center;gap:11px}
.back-btn{
  display:flex;align-items:center;gap:6px;
  font-size:12px;color:var(--dim);text-decoration:none;font-weight:400;
  padding:5px 10px;border-radius:6px;transition:background .12s,color .12s;
}
.back-btn:hover{background:var(--bg3);color:var(--text)}
.hdr-div{width:1px;height:20px;background:var(--border);margin:0 4px}
.logo{width:36px;height:36px;border-radius:50%;overflow:hidden;border:1.5px solid var(--border2);flex-shrink:0}
.logo img{width:100%;height:100%;object-fit:cover;object-position:top center}
.hdr-name{font-size:13px;font-weight:700;color:var(--bright)}
.hdr-sub{font-size:10px;color:var(--muted);font-weight:300}
.hdr-clock{font-size:11px;color:var(--muted);font-weight:300;text-align:right;line-height:1.7}

/* summary bar */
.sum-bar{
  background:var(--panel);border-bottom:1px solid var(--border);
  padding:0 28px;height:38px;display:flex;align-items:center;gap:16px;
  position:sticky;top:56px;z-index:190;
  font-size:10px;color:var(--dim);
}
.sum-bdg{
  display:inline-flex;align-items:center;gap:5px;
  padding:2px 10px;border-radius:20px;border:1px solid var(--border);font-size:10px;
}
.sum-bdg.blocked{border-color:#B070C8;color:#6A2888;background:#F3EAF8}
.sum-bdg.urgent{border-color:#D4A070;color:#8A5A28;background:#FDF1E4}
.sum-bdg.done{color:var(--muted)}
.sum-ts{margin-left:auto;font-size:9px;color:var(--muted)}

main{max-width:860px;margin:0 auto;padding:24px 24px;display:flex;flex-direction:column;gap:10px}

/* section label */
.sec-lbl{
  font-size:9px;letter-spacing:1.5px;font-weight:600;color:var(--muted);
  text-transform:uppercase;margin-bottom:10px;
  display:flex;align-items:center;gap:10px;
}
.sec-lbl::after{content:"";flex:1;height:1px;background:var(--border)}

/* task card */
.task-card{
  background:var(--panel);border:1px solid var(--border);border-radius:10px;
  padding:14px 16px;display:flex;flex-direction:column;gap:8px;
  transition:box-shadow .12s;
}
.task-card:hover{box-shadow:0 2px 12px rgba(0,0,0,.06)}
.task-card.urgent-card{border-color:var(--urgent-bd);background:var(--urgent-bg)}
.task-card.blocked-card{border-color:#B070C8;background:#F9F2FC}
.tc-top{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.tc-title{font-size:13px;font-weight:500;color:var(--bright);line-height:1.4;flex:1}
.tc-tags{display:flex;gap:5px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end}
.tag{font-size:9px;padding:2px 8px;border-radius:20px;white-space:nowrap}
.tag-pri{border:1px solid var(--border2);color:var(--dim)}
.tag-pri.urgent{border-color:#D4A070;color:#8A5A28;background:#FDF1E4}
.tag-pri.important{border-color:var(--border2);color:var(--text);background:var(--bg2)}
.tag-type{background:var(--bg3);color:var(--dim)}
.tag-type.alert{background:#E8F4E8;color:#2A6830}
.tag-type.remittance{background:#EAF3FA;color:#2A6688}
.tag-status{border:1px solid var(--border);color:var(--dim)}
.tag-status.blocked{border-color:#B070C8;color:#6A2888;background:#F3EAF8}
.tag-status.done{color:var(--muted);background:var(--bg2)}
.tc-meta{display:flex;gap:16px;font-size:10px;color:var(--dim)}
.tc-meta-item{display:flex;align-items:center;gap:4px}
.tc-meta-lbl{font-size:9px;color:var(--muted)}
.tc-blocked{
  font-size:10px;color:#6A2888;
  background:#F3EAF8;border:1px solid #D4A0DC;border-radius:6px;
  padding:5px 10px;
}
.tc-next{
  font-size:10px;color:var(--dim);
  background:var(--bg2);border-radius:6px;
  padding:5px 10px;
}

/* group */
.grp{margin-bottom:8px}

/* loading / empty */
.loading-wrap{text-align:center;padding:60px 0;font-size:12px;color:var(--muted)}

/* responsive â€” tablet */
@media(max-width:1024px){
  .hdr-name{font-size:15px}
  .hdr-sub{font-size:12px}
  .hdr-clock{font-size:13px}
  .back-btn{font-size:14px}
  .sum-bar{font-size:12px}
  .sec-lbl{font-size:11px}
  .tc-title{font-size:15px}
  .tc-meta{font-size:12px}
  .tc-next,.tc-blocked{font-size:12px}
  .tag{font-size:11px}
  .cnt-val{font-size:20px}
  .cnt-lbl{font-size:10px}
  .loading-wrap{font-size:14px}
}
/* responsive â€” phone */
@media(max-width:640px){
  header{padding:0 16px}
  .sum-bar{padding:0 16px}
  main{padding:16px}
  .tc-top{flex-direction:column;gap:6px}
  .tc-tags{justify-content:flex-start}
  .tc-title{font-size:16px}
  .tc-meta{font-size:13px}
  .tc-next,.tc-blocked{font-size:13px}
}
::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
</style>
</head>
<body>

<header>
  <div class="hdr-l">
    <a class="back-btn" href="../">â€¹ è¿”å›</a>
    <div class="hdr-div"></div>
    <div class="logo"><img src="../assets/avatar.png" alt="å¤§ç¸½ç®¡"></div>
    <div>
      <div class="hdr-name">OpenClaw</div>
      <div class="hdr-sub">é–‹ç™¼å„ªåŒ–å¸«</div>
    </div>
  </div>
  <div id="clk" class="hdr-clock"></div>
</header>

<div class="sum-bar" id="sum-bar">
  <span id="sum-content">è¼‰å…¥ä¸­â€¦</span>
  <span class="sum-ts" id="sum-ts"></span>
</div>

<main id="main">
  <div class="loading-wrap">è¼‰å…¥ä»»å‹™ä¸­â€¦</div>
</main>

<script>
const CFG = {
  name: "OpenClaw",
  role: "é–‹ç™¼å„ªåŒ–å¸«",
  dataPath: "../data/openclaw/tasks.json"
};

const PRI_ORDER = {urgent:0, important:1, normal:2};
const PRI_LBL   = {urgent:"æ€¥ä»¶", important:"é‡è¦", normal:"ä¸€èˆ¬"};
const TYPE_LBL  = {remittance:"ğŸ’³ åŒ¯æ¬¾", alert:"ğŸ”” æé†’", task:"ä»»å‹™"};
const STATUS_CLS= {"é˜»å¡":"blocked","å·²å®Œæˆ":"done"};

function fmtTs(iso){
  if(!iso||iso==="-") return "-";
  const d=new Date(iso); if(isNaN(d)) return iso;
  const now=new Date();
  if(d.toDateString()===now.toDateString()){
    return "ä»Šæ—¥ "+d.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:false});
  }
  return d.toLocaleDateString("zh-TW",{month:"2-digit",day:"2-digit"})+" "+
         d.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:false});
}

function renderSummary(tasks, ts){
  const c={pending:0,blocked:0,done:0};
  tasks.forEach(t=>{
    if(t.status==="å·²å®Œæˆ") c.done++;
    else if(t.status==="é˜»å¡") c.blocked++;
    else c.pending++;
  });
  const parts=[];
  if(c.blocked) parts.push(`<span class="sum-bdg blocked">ğŸš« é˜»å¡ ${c.blocked}</span>`);
  parts.push(`<span class="sum-bdg urgent">å¾…è™•ç† ${c.pending}</span>`);
  parts.push(`<span class="sum-bdg done">å·²å®Œæˆ ${c.done}</span>`);
  document.getElementById("sum-content").innerHTML = parts.join("");
  document.getElementById("sum-ts").textContent = "æ›´æ–° " + fmtTs(ts);
}

function taskCard(t){
  const priCls  = t.priority || "normal";
  const typeCls = t.type || "task";
  const stCls   = STATUS_CLS[t.status] || "";
  const isBlk   = t.status==="é˜»å¡";
  const isUrg   = t.priority==="urgent";

  const cardCls = isBlk ? "task-card blocked-card" : isUrg ? "task-card urgent-card" : "task-card";

  const meta=[];
  if(t.due && t.due!=="-") meta.push(`<span class="tc-meta-item"><span class="tc-meta-lbl">åˆ°æœŸ</span> ${t.due}</span>`);
  if(t.owner_role && t.owner_role!=="-") meta.push(`<span class="tc-meta-item"><span class="tc-meta-lbl">è² è²¬</span> ${t.owner_role}</span>`);

  return `<div class="${cardCls}">
    <div class="tc-top">
      <div class="tc-title">${t.title}</div>
      <div class="tc-tags">
        <span class="tag tag-pri ${priCls}">${PRI_LBL[t.priority]||t.priority}</span>
        <span class="tag tag-type ${typeCls}">${TYPE_LBL[t.type]||t.type}</span>
        <span class="tag tag-status ${stCls}">${t.status}</span>
      </div>
    </div>
    ${meta.length ? `<div class="tc-meta">${meta.join("")}</div>` : ""}
    ${t.next_step && t.next_step!=="-" ? `<div class="tc-next">â†’ ${t.next_step}</div>` : ""}
    ${t.blocked_reason && t.blocked_reason!=="-" ? `<div class="tc-blocked">ğŸš« ${t.blocked_reason}</div>` : ""}
  </div>`;
}

function renderTasks(data){
  const tasks = data.tasks || [];
  const main = document.getElementById("main");

  if(!tasks.length){
    main.innerHTML = `<div class="loading-wrap">ç›®å‰ç„¡ä»»å‹™è³‡æ–™</div>`;
    return;
  }

  renderSummary(tasks, data.updated_at);

  const groups = [
    { label:"é˜»å¡ä¸­", filter: t => t.status==="é˜»å¡" },
    { label:"å¾…è™•ç† Â· æ€¥ä»¶", filter: t => t.status!=="é˜»å¡" && t.status!=="å·²å®Œæˆ" && t.priority==="urgent" },
    { label:"å¾…è™•ç† Â· é‡è¦", filter: t => t.status!=="é˜»å¡" && t.status!=="å·²å®Œæˆ" && t.priority==="important" },
    { label:"å¾…è™•ç† Â· ä¸€èˆ¬", filter: t => t.status!=="é˜»å¡" && t.status!=="å·²å®Œæˆ" && t.priority==="normal" },
    { label:"å·²å®Œæˆ",         filter: t => t.status==="å·²å®Œæˆ" },
  ];

  main.innerHTML = groups.map(g=>{
    const items = tasks.filter(g.filter);
    if(!items.length) return "";
    return `<div class="grp">
      <div class="sec-lbl">${g.label}</div>
      ${items.map(taskCard).join("")}
    </div>`;
  }).join("");
}

async function init(){
  try{
    const r = await fetch(CFG.dataPath+"?_="+Date.now());
    if(!r.ok) throw 0;
    renderTasks(await r.json());
  } catch(e){
    document.getElementById("main").innerHTML = `<div class="loading-wrap">ç„¡æ³•è¼‰å…¥ tasks.json</div>`;
  }
}

function tick(){
  const e=document.getElementById("clk"); if(!e) return;
  const now=new Date();
  const days=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
  const date=`${String(now.getMonth()+1).padStart(2,"0")}/${String(now.getDate()).padStart(2,"0")} é€±${days[now.getDay()]}`;
  const time=now.toLocaleTimeString("zh-TW",{hour12:false,hour:"2-digit",minute:"2-digit",second:"2-digit"});
  e.innerHTML=`${time}<br>${date}`;
}
tick(); setInterval(tick,1000);
init();
</script>
</body>
</html>
