# 兆鯨水電費自動計算公式開發

**開發日期**：2026-02-18  
**開發者**：才多 Duo（開發優化師）  
**狀態**：✅ 開發完成

---

## 📋 任務概述

為兆鯨 Google Sheets 建立全自動水電費計算公式。

**Google Sheet ID**：`1Fz_n0qaqKGkI8oAA2h64mxJDkLfUpNjjWLxkh6xXmlo`  
**工作表名稱**：水電費計算

---

## 📊 工作表結構

| 欄位 | 名稱 | 說明 |
|------|------|------|
| A | 物件編號 | 物件識別碼 |
| B | 物件名稱 | 物件地址/名稱 |
| C | 承租人編號 | 承租人ID |
| D | 承租人姓名 | 承租人名稱 |
| E | 計算方式 | 每度6元/每月300/實報實銷 |
| F | 單價 | 單價或固定金額 |
| G | 上期度數 | 上期抄表度數 |
| H | 本期度數 | 本期抄表度數 |
| I | 計算金額 | **自動計算結果** |

---

## 🧮 I 欄公式（計算金額）

### 公式（I2 欄，可向下複製）

```excel
=IF(E2="每度6元", (H2-G2)*F2, IF(E2="每月300", 300, IF(E2="實報實銷", 0, 0)))
```

### 公式邏輯說明

| 計算方式 (E欄) | 計算邏輯 | 結果 |
|----------------|----------|------|
| 每度6元 | (本期度數 - 上期度數) × 單價 | 依用量計費 |
| 每月300 | 固定 $300 | $300 |
| 實報實銷 | 待手動輸入台電帳單 | $0（顯示為0，實際金額手動輸入） |
| 其他 | 預設 | $0 |

---

## 📥 初始資料匯入

### 現有承租人資料

| 物件編號 | 承租人姓名 | 計算方式 | 單價 |
|----------|------------|----------|------|
| 2-1-1 | 王原浦 | 每度6元 | 6 |
| 2-1-2 | 林瑞芳 | 每度6元 | 6 |
| 2-1-3 | 謝達源 | 每度6元 | 6 |
| 2-1-4 | 黃添榮 | 每月300 | 300 |
| 2-1-5 | 楊志生 | 實報實銷 | - |
| 2-2 | 謝瑾君 | 實報實銷 | - |
| 永二街8-1 | 陳宥宇 | 實報實銷 | - |
| 永二街8-3 | 蘇仲欽 | 實報實銷 | - |
| 永二街8-5 | 林永棠 | 實報實銷 | - |
| 永二街8-6 | 馬銘辰 | 實報實銷 | - |
| 勝利70 | 王虞鈞 | 實報實銷 | - |

---

## 🔧 手動設定步驟

### Step 1: 建立工作表結構
1. 開啟 Google Sheet
2. 在第 1 列建立標題列（A1:I1）

### Step 2: 輸入公式
1. 點選 I2 欄
2. 貼上公式：`=IF(E2="每度6元", (H2-G2)*F2, IF(E2="每月300", 300, IF(E2="實報實銷", 0, 0)))`
3. 按 Enter
4. 將 I2 向下拖曳複製到所有資料列

### Step 3: 匯入初始資料
將上述「初始資料」填入 A2:D12 及 E2:F12

### Step 4: 測試
- 輸入上期度數和本期度數
- 確認 I 欄自動計算

---

## 🤖 自動化腳本（進階）

若需要自動化匯入/更新，可使用以下 Python 腳本：

```python
import gspread
from google.oauth2.service_account import Credentials

# 設定服務帳號
scope = ['https://spreadsheets.google.com/feeds',
         'https://www.googleapis.com/auth/drive']
creds = Credentials.from_service_account_file('service_account.json', scopes=scope)
client = gspread.authorize(creds)

# 開啟試算表
spreadsheet_id = '1Fz_n0qaqKGkI8oAA2h64mxJDkLfUpNjjWLxkh6xXmlo'
sheet = client.open_by_key(spreadsheet_id).worksheet('水電費計算')

# 設定標題
headers = ['物件編號', '物件名稱', '承租人編號', '承租人姓名', 
           '計算方式', '單價', '上期度數', '本期度數', '計算金額']
sheet.update('A1:I1', [headers])

# 設定公式（I2 開始）
formula = '=IF(E2="每度6元", (H2-G2)*F2, IF(E2="每月300", 300, IF(E2="實報實銷", 0, 0)))'
# 向下複製到 100 列
for row in range(2, 101):
    sheet.update(f'I{row}', formula.replace('E2', f'E{row}').replace('H2', f'H{row}').replace('G2', f'G{row}').replace('F2', f'F{row}'))

print("公式設定完成！")
```

---

## ✅ 驗證檢查清單

- [ ] I 欄公式正確顯示計算結果
- [ ] 「每度6元」計算正確（差額×單價）
- [ ] 「每月300」固定顯示 $300
- [ ] 「實報實銷」顯示 $0（可手動覆寫）
- [ ] 公式可向下複製到新列

---

## 📝 使用說明

### 每月操作流程
1. 複製上個月的 sheet（檔案 → 複製）
2. 清除 G、H 欄的度數
3. 輸入新的本期度數
4. I 欄自動計算金額
5. 「實報實銷」的項目手動輸入台電帳單金額

### 注意事項
- 「實報實銷」項目公式預設顯示 $0，實際金額需手動輸入
- 新增承租人時，記得複製 I 欄公式到新列
- 修改計算方式時，公式會自動調整

---

**開發完成日期**：2026-02-18  
**下次檢視**：有需要調整公式時

---

*本文件由才多 Duo 開發完成*
