<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…†é¯¨é¡§å• Â· Open Claw</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@200;300;400;500;700&family=JetBrains+Mono:wght@300;400;600&display=swap" rel="stylesheet">
<style>

:root{
  --bg:#0C0C0C;--bg2:#111111;--bg3:#171717;--bg4:#1E1E1E;
  --panel:#111111;--border:#222222;--border2:#2E2E2E;
  --text:#C0C0BE;--dim:#787876;--muted:#404040;--bright:#E8E8E6;
  --urgent-bg:#0F0A04;--urgent-bd:#4A2E08;--urgent-text:#A87030;
  --blocked-bg:#060C12;--blocked-bd:#1A2E44;--blocked-text:#4A7090;
  --remit-bg:#0C0A06;--remit-bd:#3A3020;--remit-text:#807060;
  --inc:#3A8A58;--inc-bg:#081408;--inc-bd:#1A3A1A;
  --exp:#8A4040;--exp-bg:#140808;--exp-bd:#3A1818;
  --green:#3A8A58;--green-dim:#081408;
  --radius:10px;--radius-xs:5px;
}

*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:"Noto Sans TC",sans-serif;
  font-weight:300;min-height:100vh;-webkit-font-smoothing:antialiased;letter-spacing:.01em}
::-webkit-scrollbar{width:2px;height:2px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:1px}

header{display:flex;align-items:center;justify-content:space-between;
  padding:0 32px;height:52px;
  background:rgba(12,12,12,.92);border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:200;
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)}
.hdr-l{display:flex;align-items:center;gap:14px}
.back-btn{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--muted);
  text-decoration:none;padding:5px 10px;border:1px solid transparent;
  transition:border-color .15s,color .15s;letter-spacing:.05em}
.back-btn:hover{border-color:var(--border);color:var(--dim)}
.hdr-div{width:1px;height:18px;background:var(--border)}
.logo{width:26px;height:26px;border-radius:50%;overflow:hidden;border:1px solid var(--border2);
  flex-shrink:0;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:11px}
.logo img{width:100%;height:100%;object-fit:cover;object-position:top center}
.hdr-name{font-size:13px;font-weight:500;color:var(--bright);letter-spacing:.04em}
.hdr-sub{font-size:9px;color:var(--muted);font-weight:300;margin-top:1px;letter-spacing:.1em;text-transform:uppercase}
.hdr-clock{font-family:"JetBrains Mono",monospace;font-size:10px;color:var(--muted);
  text-align:right;line-height:1.9;font-weight:300}

.sum-bar{background:var(--bg2);border-bottom:1px solid var(--border);
  padding:0 32px;height:30px;display:flex;align-items:center;gap:10px;
  position:sticky;top:52px;z-index:190;font-size:10px;color:var(--muted)}
.sum-bdg{display:inline-flex;align-items:center;gap:4px;padding:2px 9px;
  border:1px solid var(--border);font-size:9px;font-weight:400;
  letter-spacing:.06em;color:var(--muted);border-radius:1px}
.sum-bdg.blocked{border-color:var(--blocked-bd);color:var(--blocked-text)}
.sum-bdg.pending{border-color:var(--border2);color:var(--dim)}
.sum-bdg.done{opacity:.5}
.sum-ts{margin-left:auto;font-size:9px;color:var(--muted);
  font-family:"JetBrains Mono",monospace;font-weight:300}

main{max-width:860px;margin:0 auto;padding:40px 32px;display:flex;flex-direction:column;gap:36px}
.sec-lbl{font-size:8px;letter-spacing:.2em;font-weight:400;color:var(--muted);
  text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:14px;
  font-family:"JetBrains Mono",monospace}
.sec-lbl::after{content:"";flex:1;height:1px;background:var(--border)}

.task-list{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.task-card{background:var(--panel);padding:18px 24px;
  display:flex;flex-direction:column;gap:9px;
  border-bottom:1px solid var(--border);
  position:relative;transition:background .13s}
.task-card:last-child{border-bottom:none}
.task-card::before{content:"";position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--border)}
.task-card.urgent-card::before{background:var(--urgent-text)}
.task-card.blocked-card::before{background:var(--blocked-text)}
.task-card.done-card{opacity:.4}
.task-card:hover{background:var(--bg3)}
.tc-top{display:flex;align-items:flex-start;justify-content:space-between;gap:14px}
.tc-title{font-size:14px;font-weight:400;color:var(--bright);line-height:1.6;flex:1;letter-spacing:.02em}
.tc-tags{display:flex;gap:4px;flex-shrink:0;flex-wrap:wrap;justify-content:flex-end}
.tag{font-size:8px;padding:2px 7px;border:1px solid var(--border);color:var(--muted);
  white-space:nowrap;font-weight:400;letter-spacing:.08em;text-transform:uppercase;border-radius:1px}
.tag.urgent{border-color:var(--urgent-bd);color:var(--urgent-text)}
.tag.important{border-color:var(--border2);color:var(--dim)}
.tag.blocked-tag{border-color:var(--blocked-bd);color:var(--blocked-text)}
.tag.remittance{border-color:var(--remit-bd);color:var(--remit-text)}
.tag.alert-tag{border-color:#1E3A1E;color:var(--green)}
.tc-meta{display:flex;gap:18px;font-size:10px;color:var(--muted);
  font-family:"JetBrains Mono",monospace;font-weight:300}
.tc-meta-lbl{font-size:8px;opacity:.6;margin-right:3px}
.tc-next{font-size:11px;color:var(--dim);padding-top:8px;
  border-top:1px solid var(--border);font-weight:300;letter-spacing:.02em}
.tc-blocked{font-size:11px;color:var(--blocked-text);padding-top:8px;
  border-top:1px solid var(--blocked-bd);font-weight:300}
.loading-wrap{text-align:center;padding:60px;font-size:12px;color:var(--muted);letter-spacing:.06em}

.tab-nav{background:var(--bg2);border-bottom:1px solid var(--border);
  display:flex;position:sticky;top:82px;z-index:180}
.tab-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:3px;height:56px;padding:0 8px;color:var(--muted);text-decoration:none;cursor:pointer;
  user-select:none;border-bottom:2px solid transparent;
  transition:color .15s,border-color .15s,background .15s;font-size:11px;letter-spacing:.06em}
.tab-btn:hover{color:var(--dim);background:var(--bg3)}
.tab-btn.active{color:var(--bright);border-bottom-color:var(--urgent-text);background:var(--bg3)}
.tab-icon{font-size:16px;line-height:1}
.tab-label{font-size:9px;text-transform:uppercase;letter-spacing:.1em;font-weight:400}
.tab-badge{font-size:9px;font-weight:400;background:var(--bg4);color:var(--muted);
  border:1px solid var(--border);border-radius:1px;padding:1px 6px;
  font-family:"JetBrains Mono",monospace;min-width:20px;text-align:center}
.tab-badge.hot{background:var(--urgent-bg);color:var(--urgent-text);border-color:var(--urgent-bd)}
.tab-panel{display:none}.tab-panel.active{display:block}

/* property & tenant cards */
.prop-list,.tenant-list{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.prop-card,.tenant-card{
  background:var(--panel);padding:18px 24px;
  display:flex;flex-direction:column;gap:9px;
  border-bottom:1px solid var(--border);
  position:relative;transition:background .13s}
.prop-card:last-child,.tenant-card:last-child{border-bottom:none}
.prop-card::before,.tenant-card::before{content:"";position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--border)}
.prop-card.s-æ‹›ç§Ÿä¸­::before,.tenant-card.s-æ¬ ç§Ÿ::before{background:var(--urgent-text)}
.prop-card.s-ç„¡åˆç´„::before,.tenant-card.s-ç„¡åˆç´„::before{background:var(--blocked-text)}
.prop-card:hover,.tenant-card:hover{background:var(--bg3)}
.pc-top,.tc-top2{display:flex;align-items:flex-start;justify-content:space-between;gap:14px}
.pc-addr,.tc-name{font-size:14px;font-weight:400;color:var(--bright);flex:1;letter-spacing:.02em}
.status-badge{font-size:8px;padding:2px 8px;border:1px solid var(--border);
  color:var(--muted);border-radius:1px;letter-spacing:.1em;text-transform:uppercase;white-space:nowrap}
.status-badge.å·²å‡ºç§Ÿ,.status-badge.æ­£å¸¸{border-color:#1E3A1E;color:var(--green)}
.status-badge.æ‹›ç§Ÿä¸­,.status-badge.æ¬ ç§Ÿ{border-color:var(--urgent-bd);color:var(--urgent-text)}
.status-badge.ç„¡åˆç´„{border-color:var(--blocked-bd);color:var(--blocked-text)}
.status-badge.å”å•†ä¸­{border-color:var(--remit-bd);color:var(--remit-text)}
.pc-meta,.tc-meta2{display:flex;flex-wrap:wrap;gap:16px;font-size:10px;color:var(--muted);
  font-family:"JetBrains Mono",monospace;font-weight:300}
.pc-meta-lbl,.tc-meta-lbl2{font-size:8px;opacity:.6;margin-right:3px}
.pc-note,.tc-note{font-size:11px;color:var(--dim);padding-top:8px;border-top:1px solid var(--border);font-weight:300}
.tab-nav{top:82px}
@media(max-width:1024px){
  main{padding:32px 24px;gap:28px}
  .hdr-name{font-size:17px}.hdr-clock{font-size:14px}.back-btn{font-size:15px}
  .sum-bar{height:38px}.tab-btn{height:64px}.tab-label{font-size:12px}
  .tc-title,.pc-addr,.tc-name{font-size:18px}.tc-meta{font-size:14px}.tag{font-size:12px;padding:3px 9px}
}
@media(max-width:640px){
  header{padding:0 20px}.sum-bar{padding:0 20px}
  main{padding:24px 18px;gap:24px}
  .tab-btn{height:56px}.tab-label{font-size:10px}
  .tc-top,.pc-top,.tc-top2{flex-direction:column;gap:8px}.tc-tags{justify-content:flex-start}
}

@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
main>div{animation:fadeUp .4s ease both}
main>div:nth-child(2){animation-delay:.08s}
main>div:nth-child(3){animation-delay:.16s}
main>div:nth-child(4){animation-delay:.24s}
</style>
</head>
<body>

<header>
  <div class="hdr-l">
    <a class="back-btn" href="../">â€¹ è¿”å›</a>
    <div class="hdr-div"></div>
    <div class="logo"><img src="../assets/avatar.png" alt="OC" onerror="this.style.display='none';this.parentElement.textContent='ğŸ¢'"></div>
    <div>
      <div class="hdr-name">å…†é¯¨é¡§å•</div>
      <div class="hdr-sub">é¡§å• Â· ç‰©æ¥­ Â· é›»å•†</div>
    </div>
  </div>
  <div id="clk" class="hdr-clock"></div>
</header>
<div class="sum-bar">
  <span id="sum-content">è¼‰å…¥ä¸­â€¦</span>
  <span class="sum-ts" id="sum-ts"></span>
</div>

<nav class="tab-nav">
  <a class="tab-btn active" onclick="switchTab('tasks')" id="tab-tasks">
    <span class="tab-badge" id="badge-tasks">â€”</span>
    <span class="tab-icon">ğŸ“‹</span>
    <span class="tab-label">å·¥ä½œä»»å‹™</span>
  </a>
  <a class="tab-btn" onclick="switchTab('props')" id="tab-props">
    <span class="tab-badge" id="badge-props">â€”</span>
    <span class="tab-icon">ğŸ </span>
    <span class="tab-label">ç‰©ä»¶è³‡æ–™</span>
  </a>
  <a class="tab-btn" onclick="switchTab('tenants')" id="tab-tenants">
    <span class="tab-badge" id="badge-tenants">â€”</span>
    <span class="tab-icon">ğŸ‘¤</span>
    <span class="tab-label">æˆ¿å®¢è³‡æ–™</span>
  </a>
</nav>

<div class="tab-panel active" id="panel-tasks"><main id="main-tasks"><div class="loading-wrap">è¼‰å…¥ä¸­â€¦</div></main></div>
<div class="tab-panel" id="panel-props"><main id="main-props"><div class="loading-wrap">è¼‰å…¥ä¸­â€¦</div></main></div>
<div class="tab-panel" id="panel-tenants"><main id="main-tenants"><div class="loading-wrap">è¼‰å…¥ä¸­â€¦</div></main></div>

<script>

function tick(){
  const e=document.getElementById("clk");if(!e)return;
  const n=new Date();const days=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
  e.innerHTML=n.toLocaleTimeString("zh-TW",{hour12:false,hour:"2-digit",minute:"2-digit",second:"2-digit"})
    +"<br>"+String(n.getMonth()+1).padStart(2,"0")+"/"+String(n.getDate()).padStart(2,"0")+" é€±"+days[n.getDay()];
}
tick();setInterval(tick,1000);

function fmtTs(iso){
  if(!iso||iso==="-") return "-";
  const d=new Date(iso);if(isNaN(d)) return iso;
  const now=new Date();
  if(d.toDateString()===now.toDateString()) return d.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit",hour12:false});
  return d.toLocaleDateString("zh-TW",{month:"2-digit",day:"2-digit"});
}

const PRI_LBL={urgent:"æ€¥ä»¶",important:"é‡è¦",normal:"ä¸€èˆ¬"};
const TYPE_LBL={remittance:"åŒ¯æ¬¾",alert:"æé†’",task:"ä»»å‹™"};

function renderSummary(tasks,ts,barId="sum-bar"){
  const c={pending:0,blocked:0,done:0};
  tasks.forEach(t=>{if(t.status==="å·²å®Œæˆ")c.done++;else if(t.status==="é˜»å¡")c.blocked++;else c.pending++;});
  let html="";
  if(c.blocked) html+=`<span class="sum-bdg blocked">é˜»å¡ ${c.blocked}</span>`;
  html+=`<span class="sum-bdg pending">å¾…è™•ç† ${c.pending}</span>`;
  html+=`<span class="sum-bdg done">å·²å®Œæˆ ${c.done}</span>`;
  document.getElementById("sum-content").innerHTML=html;
  document.getElementById("sum-ts").textContent="æ›´æ–° "+fmtTs(ts);
}

function taskCard(t){
  const isBlk=t.status==="é˜»å¡",isUrg=t.priority==="urgent",isDone=t.status==="å·²å®Œæˆ";
  const cardCls=isBlk?"task-card blocked-card":isUrg?"task-card urgent-card":isDone?"task-card done-card":"task-card";
  const tags=[];
  if(isUrg) tags.push(`<span class="tag urgent">æ€¥ä»¶</span>`);
  else if(t.priority==="important") tags.push(`<span class="tag important">é‡è¦</span>`);
  if(t.type==="remittance") tags.push(`<span class="tag remittance">åŒ¯æ¬¾</span>`);
  else if(t.type==="alert") tags.push(`<span class="tag alert-tag">æé†’</span>`);
  if(isBlk) tags.push(`<span class="tag blocked-tag">é˜»å¡</span>`);
  if(isDone) tags.push(`<span class="tag" style="opacity:.4">å®Œæˆ</span>`);
  const meta=[];
  if(t.time&&t.time!=="-") meta.push(`<span><span class="tc-meta-lbl">æ’ç¨‹ </span>${t.time}</span>`);
  if(t.due&&t.due!=="-") meta.push(`<span><span class="tc-meta-lbl">æˆªæ­¢ </span>${t.due}</span>`);
  if(t.owner_role&&t.owner_role!=="-") meta.push(`<span><span class="tc-meta-lbl">è² è²¬ </span>${t.owner_role}</span>`);
  return `<div class="${cardCls}">
    <div class="tc-top">
      <div class="tc-title">${t.title}</div>
      ${tags.length?`<div class="tc-tags">${tags.join("")}</div>`:""}
    </div>
    ${meta.length?`<div class="tc-meta">${meta.join("")}</div>`:""}
    ${t.next_step&&t.next_step!=="-"?`<div class="tc-next">â†’ ${t.next_step}</div>`:""}
    ${t.blocked_reason&&t.blocked_reason!=="-"?`<div class="tc-blocked">é˜»å¡ â€” ${t.blocked_reason}</div>`:""}
  </div>`;
}

function renderTaskGroups(tasks,containerId){
  const el=document.getElementById(containerId||"main");
  const groups=[
    {label:"é˜»å¡ä¸­",    fn:t=>t.status==="é˜»å¡"},
    {label:"æ€¥ä»¶",      fn:t=>t.status!=="é˜»å¡"&&t.status!=="å·²å®Œæˆ"&&t.priority==="urgent"},
    {label:"é‡è¦",      fn:t=>t.status!=="é˜»å¡"&&t.status!=="å·²å®Œæˆ"&&t.priority==="important"},
    {label:"å¾…è™•ç†",    fn:t=>t.status!=="é˜»å¡"&&t.status!=="å·²å®Œæˆ"&&(!t.priority||t.priority==="normal")},
    {label:"å·²å®Œæˆ",    fn:t=>t.status==="å·²å®Œæˆ"},
  ];
  const html=groups.map(g=>{
    const items=tasks.filter(g.fn);
    if(!items.length) return "";
    return `<div><div class="sec-lbl">${g.label}</div><div class="task-list">${items.map(taskCard).join("")}</div></div>`;
  }).join("");
  el.innerHTML=html||`<div class="loading-wrap">â€” ç›®å‰ç„¡ä»»å‹™ â€”</div>`;
}

function switchTab(tab){
  ["tasks","props","tenants"].forEach(t=>{
    document.getElementById("panel-"+t).classList.toggle("active",t===tab);
    document.getElementById("tab-"+t).classList.toggle("active",t===tab);
  });
}
function propCard(p){
  const st=p.status||"";const cls="prop-card s-"+st.replace(/\s/g,"");
  const rent=p.rent?`NT$ ${p.rent.toLocaleString("zh-TW")}/æœˆ`:"â€”";
  return `<div class="${cls}">
    <div class="pc-top">
      <div class="pc-addr">ğŸ  ${p.address}</div>
      <span class="status-badge ${st}">${st}</span>
    </div>
    <div class="pc-meta">
      <span><span class="pc-meta-lbl">é¡å‹ </span>${p.type||"â€”"}</span>
      <span><span class="pc-meta-lbl">ç§Ÿé‡‘ </span>${rent}</span>
      <span><span class="pc-meta-lbl">æ‰¿ç§Ÿäºº </span>${p.tenant||"â€”"}</span>
      ${p.contract_end&&p.contract_end!=="-"?`<span><span class="pc-meta-lbl">åˆç´„åˆ°æœŸ </span>${p.contract_end}</span>`:""}
    </div>
    ${p.note&&p.note!=="-"?`<div class="pc-note">â†’ ${p.note}</div>`:""}
  </div>`;
}
function tenantCard(t){
  const st=t.status||"";const cls="tenant-card s-"+st.replace(/\s/g,"");
  return `<div class="${cls}">
    <div class="tc-top2">
      <div class="tc-name">ğŸ‘¤ ${t.name}</div>
      <span class="status-badge ${st}">${st}</span>
    </div>
    <div class="tc-meta2">
      <span><span class="tc-meta-lbl2">ç‰©ä»¶ </span>${t.property||"â€”"}</span>
      <span><span class="tc-meta-lbl2">æœˆç§Ÿ </span>${t.rent?`NT$ ${t.rent.toLocaleString("zh-TW")}`:"â€”"}</span>
      ${t.arrears>0?`<span style="color:var(--urgent-text)"><span class="tc-meta-lbl2">æ¬ ç§Ÿ </span>NT$ ${t.arrears.toLocaleString("zh-TW")}</span>`:""}
      ${t.contract_end&&t.contract_end!=="-"?`<span><span class="tc-meta-lbl2">åˆç´„åˆ°æœŸ </span>${t.contract_end}</span>`:""}
      ${t.contact&&t.contact!=="-"?`<span><span class="tc-meta-lbl2">è¯çµ¡ </span>${t.contact}</span>`:""}
    </div>
    ${t.note&&t.note!=="-"?`<div class="tc-note">â†’ ${t.note}</div>`:""}
  </div>`;
}
function renderProps(props){
  const el=document.getElementById("main-props");
  document.getElementById("badge-props").textContent=props.length;
  const warn=props.filter(p=>["æ‹›ç§Ÿä¸­","ç„¡åˆç´„"].includes(p.status));
  const ok=props.filter(p=>p.status==="å·²å‡ºç§Ÿ");
  let html="";
  if(warn.length) html+=`<div><div class="sec-lbl">éœ€é—œæ³¨</div><div class="prop-list">${warn.map(propCard).join("")}</div></div>`;
  if(ok.length) html+=`<div><div class="sec-lbl">å·²å‡ºç§Ÿ</div><div class="prop-list">${ok.map(propCard).join("")}</div></div>`;
  el.innerHTML=html||`<div class="loading-wrap">â€” ç›®å‰ç„¡ç‰©ä»¶è³‡æ–™ â€”</div>`;
}
function renderTenants(tenants){
  const el=document.getElementById("main-tenants");
  document.getElementById("badge-tenants").textContent=tenants.length;
  const warn=tenants.filter(t=>["æ¬ ç§Ÿ","ç„¡åˆç´„","å”å•†ä¸­"].includes(t.status));
  const ok=tenants.filter(t=>t.status==="æ­£å¸¸");
  let html="";
  if(warn.length) html+=`<div><div class="sec-lbl">éœ€é—œæ³¨</div><div class="tenant-list">${warn.map(tenantCard).join("")}</div></div>`;
  if(ok.length) html+=`<div><div class="sec-lbl">æ­£å¸¸ç§Ÿæˆ¶</div><div class="tenant-list">${ok.map(tenantCard).join("")}</div></div>`;
  el.innerHTML=html||`<div class="loading-wrap">â€” ç›®å‰ç„¡æˆ¿å®¢è³‡æ–™ â€”</div>`;
}
async function init(){
  const [taskRes,propRes,tenantRes]=await Promise.all([
    fetch("../data/zhaojing/tasks.json?_="+Date.now()).then(r=>r.ok?r.json():null).catch(()=>null),
    fetch("../data/zhaojing/properties.json?_="+Date.now()).then(r=>r.ok?r.json():null).catch(()=>null),
    fetch("../data/zhaojing/tenants.json?_="+Date.now()).then(r=>r.ok?r.json():null).catch(()=>null),
  ]);
  if(taskRes){renderSummary(taskRes.tasks||[],taskRes.updated_at);renderTaskGroups(taskRes.tasks||[],"main-tasks");}
  else document.getElementById("main-tasks").innerHTML=`<div class="loading-wrap">ç„¡æ³•è¼‰å…¥ä»»å‹™</div>`;
  renderProps(propRes?.properties||[]);
  renderTenants(tenantRes?.tenants||[]);
}
init();
</script>
</body>
</html>